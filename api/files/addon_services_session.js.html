<!DOCTYPE html>
<html>
  <head>
    <title>addon/services/session.js - The Ember Simple Auth API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/vendor/css/github.css">
    <link rel="stylesheet" href="../assets/vendor/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <script src="../assets/vendor/js/jquery.min.js"></script>
    <script src="../assets/vendor/js/bootstrap.min.js"></script>
    <script src="../assets/vendor/js/highlight.pack.js"></script>
  </head>
  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="../index.html">The Ember Simple Auth API</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/simplabs/ember-simple-auth"><i class="fa fa-github"></i> Source Code</a></li>
            <li><p class="navbar-text project-version"><a href="https://github.com/simplabs/ember-simple-auth/releases/tag/1.1.0-beta.1"><span class="label label-primary">1.1.0-beta.1</span></a></p></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div id="sidebar" class="col-sm-3">
          <div class="row">
            <div id="classes" class="col-sm-12">
              <h4>Classes</h4>
              <ul class="list-unstyled">
                  <li><a href="../classes/AdaptiveStore.html">AdaptiveStore</a></li>
                  <li><a href="../classes/ApplicationRouteMixin.html">ApplicationRouteMixin</a></li>
                  <li><a href="../classes/AuthenticatedRouteMixin.html">AuthenticatedRouteMixin</a></li>
                  <li><a href="../classes/BaseAuthenticator.html">BaseAuthenticator</a></li>
                  <li><a href="../classes/BaseAuthorizer.html">BaseAuthorizer</a></li>
                  <li><a href="../classes/BaseStore.html">BaseStore</a></li>
                  <li><a href="../classes/Configuration.html">Configuration</a></li>
                  <li><a href="../classes/CookieStore.html">CookieStore</a></li>
                  <li><a href="../classes/DataAdapterMixin.html">DataAdapterMixin</a></li>
                  <li><a href="../classes/DeviseAuthenticator.html">DeviseAuthenticator</a></li>
                  <li><a href="../classes/DeviseAuthorizer.html">DeviseAuthorizer</a></li>
                  <li><a href="../classes/EphemeralStore.html">EphemeralStore</a></li>
                  <li><a href="../classes/LocalStorageStore.html">LocalStorageStore</a></li>
                  <li><a href="../classes/OAuth2BearerAuthorizer.html">OAuth2BearerAuthorizer</a></li>
                  <li><a href="../classes/OAuth2PasswordGrantAuthenticator.html">OAuth2PasswordGrantAuthenticator</a></li>
                  <li><a href="../classes/SessionService.html">SessionService</a></li>
                  <li><a href="../classes/ToriiAuthenticator.html">ToriiAuthenticator</a></li>
                  <li><a href="../classes/UnauthenticatedRouteMixin.html">UnauthenticatedRouteMixin</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div id="main" class="col-sm-9">
          <h1 class="file-heading">File: addon/services/session.js</h1>
          
          <div class="file">
              <pre class="code prettyprint linenums">
          import Ember from &#x27;ember&#x27;;
          import getOwner from &#x27;ember-getowner-polyfill&#x27;;
          
          const SESSION_DATA_KEY_PREFIX = /^data\./;
          
          const { computed, on }  = Ember;
          
          /**
            __The session service provides access to the current session as well as
            methods to authenticate and invalidate it__ etc. It is the main interface for
            the application to Ember Simple Auth&#x27;s functionality. It can be injected via
          
            &#x60;&#x60;&#x60;js
            // app/components/login-form.js
            import Ember from &#x27;ember&#x27;;
          
            export default Ember.Component.extend({
              session: Ember.inject.service(&#x27;session&#x27;)
            });
            &#x60;&#x60;&#x60;
          
            @class SessionService
            @module ember-simple-auth/services/session
            @extends Ember.Service
            @uses Ember.Evented
            @public
          */
          export default Ember.Service.extend(Ember.Evented, {
            /**
              Triggered whenever the session is successfully authenticated. This happens
              when the session gets authenticated via
              {{#crossLink &quot;SessionService/authenticate:method&quot;}}{{/crossLink}} but also
              when the session is authenticated in another tab or window of the same
              application and the session state gets synchronized across tabs or windows
              via the store (see
              {{#crossLink &quot;BaseStore/sessionDataUpdated:event&quot;}}{{/crossLink}}).
          
              When using the {{#crossLink &quot;ApplicationRouteMixin&quot;}}{{/crossLink}} this
              event will automatically get handled (see
              {{#crossLink &quot;ApplicationRouteMixin/sessionAuthenticated:method&quot;}}{{/crossLink}}).
          
              @event authenticationSucceeded
              @public
            */
          
            /**
              Triggered whenever the session is successfully invalidated. This happens
              when the session gets invalidated via
              {{#crossLink &quot;SessionService/invalidate:method&quot;}}{{/crossLink}} but also
              when the session is invalidated in another tab or window of the same
              application and the session state gets synchronized across tabs or windows
              via the store (see
              {{#crossLink &quot;BaseStore/sessionDataUpdated:event&quot;}}{{/crossLink}}).
          
              When using the {{#crossLink &quot;ApplicationRouteMixin&quot;}}{{/crossLink}} this
              event will automatically get handled (see
              {{#crossLink &quot;ApplicationRouteMixin/sessionInvalidated:method&quot;}}{{/crossLink}}).
          
              @event invalidationSucceeded
              @public
            */
          
            /**
              Returns whether the session is currently authenticated.
          
              @property isAuthenticated
              @type Boolean
              @readOnly
              @default false
              @public
            */
            isAuthenticated: computed.oneWay(&#x27;session.isAuthenticated&#x27;),
          
            /**
              The current session data as a plain object. The
              &#x60;authenticated&#x60; key holds the session data that the authenticator resolved
              with when the session was authenticated (see
              {{#crossLink &quot;BaseAuthenticator/authenticate:method&quot;}}{{/crossLink}}) and
              that will be cleared when the session is invalidated. This data cannot be
              written. All other session data is writable and will not be cleared when
              the session is invalidated.
          
              @property data
              @type Object
              @readOnly
              @default { authenticated: {} }
              @public
            */
            data: computed.oneWay(&#x27;session.content&#x27;),
          
            /**
              The session store.
          
              @property store
              @type BaseStore
              @readOnly
              @default null
              @public
            */
            store: computed.oneWay(&#x27;session.store&#x27;),
          
            /**
              A previously attempted but intercepted transition (e.g. by the
              {{#crossLink &quot;AuthenticatedRouteMixin&quot;}}{{/crossLink}}). If an attempted
              transition is present, the
              {{#crossLink &quot;ApplicationRouteMixin&quot;}}{{/crossLink}} will retry it when the
              session becomes authenticated (see
              {{#crossLink &quot;ApplicationRouteMixin/sessionAuthenticated:method&quot;}}{{/crossLink}}).
          
              @property attemptedTransition
              @type Transition
              @default null
              @public
            */
            attemptedTransition: computed.alias(&#x27;session.attemptedTransition&#x27;),
          
            set(key, value) {
              const setsSessionData = SESSION_DATA_KEY_PREFIX.test(key);
              if (setsSessionData) {
                const sessionDataKey = &#x60;session.${key.replace(SESSION_DATA_KEY_PREFIX, &#x27;&#x27;)}&#x60;;
                return this._super(sessionDataKey, value);
              } else {
                return this._super(...arguments);
              }
            },
          
            _forwardSessionEvents: on(&#x27;init&#x27;, function() {
              Ember.A([
                &#x27;authenticationSucceeded&#x27;,
                &#x27;invalidationSucceeded&#x27;
              ]).forEach((event) =&gt; {
                // the internal session won&#x27;t be available in route unit tests
                const session = this.get(&#x27;session&#x27;);
                if (session) {
                  session.on(event, () =&gt; {
                    this.trigger(event, ...arguments);
                  });
                }
              });
            }),
          
            /**
              __Authenticates the session with an &#x60;authenticator&#x60;__ and appropriate
              arguments. The authenticator implements the actual steps necessary to
              authenticate the session (see
              {{#crossLink &quot;BaseAuthenticator/authenticate:method&quot;}}{{/crossLink}}) and
              returns a promise after doing so. The session handles the returned promise
              and when it resolves becomes authenticated, otherwise remains
              unauthenticated. All data the authenticator resolves with will be
              accessible via the
              {{#crossLink &quot;SessionService/data:property&quot;}}session data&#x27;s{{/crossLink}}
              &#x60;authenticated&#x60; property.
          
              __This method returns a promise. A resolving promise indicates that the
              session was successfully authenticated__ while a rejecting promise
              indicates that authentication failed and the session remains
              unauthenticated. The promise does not resolve with a value; instead, the
              data returned from the authenticator is available via the
              {{#crossLink &quot;SessionService/data:property&quot;}}{{/crossLink}} property.
          
              When authentication succeeds this will trigger the
              {{#crossLink &quot;SessionService/authenticationSucceeded:event&quot;}}{{/crossLink}}
              event.
          
              @method authenticate
              @param {String} authenticator The authenticator to use to authenticate the session
              @param {Any} [...args] The arguments to pass to the authenticator; depending on the type of authenticator these might be a set of credentials, a Facebook OAuth Token, etc.
              @return {Ember.RSVP.Promise} A promise that resolves when the session was authenticated successfully and rejects otherwise
              @public
            */
            authenticate() {
              const session = this.get(&#x27;session&#x27;);
              return session.authenticate(...arguments);
            },
          
            /**
              __Invalidates the session with the authenticator it is currently
              authenticated with__ (see
              {{#crossLink &quot;SessionService/authenticate:method&quot;}}{{/crossLink}}). This
              invokes the authenticator&#x27;s
              {{#crossLink &quot;BaseAuthenticator/invalidate:method&quot;}}{{/crossLink}} method
              and handles the returned promise accordingly.
          
              This method returns a promise. A resolving promise indicates that the
              session was successfully invalidated while a rejecting promise indicates
              that invalidation failed and the session remains authenticated. Once the
              session is successfully invalidated it clears all of its authenticated data
              (see {{#crossLink &quot;SessionService/data:property&quot;}}{{/crossLink}}).
          
              When invalidation succeeds this will trigger the
              {{#crossLink &quot;SessionService/invalidationSucceeded:event&quot;}}{{/crossLink}}
              event.
          
              @method invalidate
              @return {Ember.RSVP.Promise} A promise that resolves when the session was invalidated successfully and rejects otherwise
              @public
            */
            invalidate() {
              const session = this.get(&#x27;session&#x27;);
              return session.invalidate(...arguments);
            },
          
            /**
              Authorizes a block of code with an authorizer (see
              {{#crossLink &quot;BaseAuthorizer/authorize:method&quot;}}{{/crossLink}}) if the
              session is authenticated. If the session is not currently authenticated
              this method does nothing.
          
              &#x60;&#x60;&#x60;js
              this.get(&#x27;session&#x27;).authorize(&#x27;authorizer:oauth2-bearer&#x27;, (headerName, headerValue) =&gt; {
                xhr.setRequestHeader(headerName, headerValue);
              });
              &#x60;&#x60;&#x60;
          
              @method authorize
              @param {String} authorizer The authorizer to authorize the block with
              @param {Function} block The block of code to call with the authorization data generated by the authorizer
              @public
            */
            authorize(authorizerFactory, block) {
              if (this.get(&#x27;isAuthenticated&#x27;)) {
                const authorizer = getOwner(this).lookup(authorizerFactory);
                const sessionData = this.get(&#x27;data.authenticated&#x27;);
                authorizer.authorize(sessionData, block);
              }
            }
          });
          
              </pre>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" charset="utf-8">
      function fixLeadingWhitespace(codeBlock) {
        var text = $(codeBlock).text();
        var lines = text.split('\n');
        var minLeadindSpaces = text.length;
        $.each(lines.slice(1), function(i, line) {
          var match = line.match(/^\s+/);
          if (match) {
            minLeadindSpaces = Math.min(match[0].length);
          }
        });
        var regexp = new RegExp('^\\s{' + minLeadindSpaces + '}');
        var fixedLines = lines.slice(0, 1).concat($.map(lines.slice(1), function(line) {
          return line.replace(regexp, '');
        }));
        $(codeBlock).text(fixedLines.join('\n'));
      }

      $(document).ready(function() {
        $('pre code').each(function(i, codeBlock) {
          fixLeadingWhitespace(codeBlock);
          hljs.highlightBlock(codeBlock);
        });
      });
    </script>
  </body>
</html>
